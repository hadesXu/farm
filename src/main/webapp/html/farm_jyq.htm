<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

    <meta name="Generator" content="ECSHOP v2.7.3"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no, address=no, email=no">

    <meta name="renderer" content="webkit">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>交易区-6440</title>

    <link href="../css/qui.css" rel="stylesheet">

    <link href="../css/style.css" rel="stylesheet">

    <style>

        .pdmc {
            position: absolute;
            top: 58% !important;
        }

        .pdmr_s {
            width: 94%;
            position: absolute;
            top: 9%;
            font-size: 14px;
            color: #fff;
            left: 2%;
        }

        .pdmr_s ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .pdmr_s ul li {
            height: 40px;
            line-height: 40px;
            float: left;
            text-align: center;
        }

        .sc_s ul li {
            height: 46px;
            line-height: 30px;
        }

        .pdmr {
            width: 94%;
            position: absolute;
            top: 9%;
            font-size: 14px;
            color: #fff;
            left: 2%;
        }

        .pdmr ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .pdmr ul li {
            width: 25%;
            height: 40px;
            line-height: 40px;
            float: left;
            text-align: center;
        }

        .sc ul li {
            height: 23px;
            line-height: 23px;
        }

        .ddcj {
            color: #fff;;
        }

        .btn {
            position: absolute;
            bottom: 10%;
            left: 6%;
        }

        .btn input {
            color: #fff;
            background: #c87318;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            height: 26px;
            margin-left: 10px;
        }

        .jjsh {
            width: 86%;
            border-radius: 5px;
            display: block;
            background: rgba(184, 33, 10, 0.92);
        }


    </style>

</head>

<body style="overflow-y: auto;">

<div class="warp-page" style=" background:url(../img/listbox.jpg) no-repeat; background-size:100% 100%;">
    <div class="warp-page" style=" background:url(../img/jyq_bg.png) no-repeat; background-size:98% 98%;margin-left:2%;">
        <div style="position:absolute;top:6px;text-align:center;right:0;">
            <a href="javascript:history.back(-1)"><img src="../img/close.png" style="width:40px;height:40px;margin-right:10px;"></a>
        </div>
        <div class="pdmr_s">
            排队买入区：
            <ul>
                <li style="width:25%">头像</li>
                <li style="width:30%">昵称</li>
                <li style="width:15%">类型</li>
                <li style="width:15%">数量</li>
                <li style="width:15%">操作</li>
            </ul>
            <div class="sc_s" id="allOrderList"></div>
        </div>
        <div style="position:absolute;top:50%;text-align:right;right:0;width:97%;">
            <a href="#" onclick="moreAllOrder()"><img src="../img/gd.png" style="width:70px;height:40px;margin-right:20px;"></a>
            <div style="width:94%;height:1px;border-bottom:1px dotted #fff;"></div>
        </div>


        <div class="pdmc pdmr" >
            排队售出区：
            <ul>
                <li>挂单时间</li>
                <li>类型</li>
                <li>数量</li>
                <li>状态</li>
            </ul>
            <div class="sc" id="myOrderList">

            </div>

        </div>


        <div style="position:absolute;bottom:12%;text-align:center;right:0;">
            <a href="#" onclick="myOrderMore()"><img src="../img/gd.png" style="width:70px;height:40px;margin-right:20px;"></a>
        </div>


        <!--<div style="position:absolute;bottom:35px;text-align:center;">

            <img src="../img/gmls.png"  class="tools04 up-box" style="width:60%;height:32px;">

        </div>-->

        <div class="btn">

            <input type="button" class="up-box1" value="买入" style="background:#c87318;">

            <input type="button" class="up-box" value="卖出" style="background:#c87318;">

            <input type="button" class="up-box3" value="购买饲料" style="background:#c87318;">


        </div>


    </div>

</div>


<style type="text/css">


    .close-up {

        position: absolute;

        top: 1rem;

        right: -.5rem;

        color: blue;

        background: url(../img/close.png) no-repeat;

        background-size: 100% 100%;

        height: 2.2rem;

        width: 2rem;

    }

    .all-gold {

        padding-top: 3.5rem;

        padding-left: 1.6rem;

        font-size: .8rem;

        color: #723308;

        font-weight: bold;

    }

    .top-gold {

        padding: .6rem 0 .6rem 1.6rem;

        font-size: .8rem;

        color: #723308;

        font-weight: bold;

    }

    .top-gold div {

        float: left;

    }

    .top-gold input {

        width: 7rem;

        background: white;

        border: none

    }

    .popup-box {

        width: 100%;

        height: 100%;

        background: rgba(22, 22, 22, .3);

        position: absolute;

        left: 0;

        top: 0;

        overflow: hidden;

        display: none;

        z-index: 9;

    }

    .popup-box1 {

        width: 100%;

        height: 100%;

        background: rgba(22, 22, 22, .3);

        position: absolute;

        left: 0;

        top: 0;

        overflow: hidden;

        display: none;

        z-index: 9;

    }

    .popup-box2 {

        width: 100%;

        height: 100%;

        background: rgba(22, 22, 22, .3);

        position: absolute;

        left: 0;

        top: 0;

        overflow: hidden;

        display: none;

        z-index: 9;

    }

    .popup-box3 {

        width: 100%;

        height: 100%;

        background: rgba(22, 22, 22, .3);

        position: absolute;

        left: 0;

        top: 0;

        overflow: hidden;

        display: none;

        z-index: 9;

    }

    .popup {

        position: absolute;

        top: 45%;

        left: 50%;

        margin-top: -40%;

        margin-left: -45%;

        width: 90%;

        height: 40%;

        min-height: 320px;

        background: url(../img/shops.png) no-repeat;

        background-size: 100% 100%;

        z-index: 9;

    }

    .close-x {

        position: absolute;

        top: -.3rem;

        right: 0;

        color: blue;

        background: url(../img/close.png) no-repeat;

        background-size: 100% 100%;

        height: 2.4rem;

        width: 2rem;

    }

    .popup-con {

        width: 80%;

        margin-left: 10%;

        text-align: center;

        position: absolute;

        top: 26%;

    }

    .popup-con ul {
        margin: 0px;
        padding: 0px;
        list-style: none;
    }

    .popup-con ul li {
        width: 100%;
        height: 30px;
        line-height: 30px;
        font-size: 18px;
    }

    /*买入 poup-box2 */

    .mr_input {
        width: 50%;
        height: 30px;
        line-height: 30px;
        border-radius: 5px;
        text-indent: 5px;
    }

    /*平台售出*/

    .ptsc_li {
        margin-left: 9%;
        text-align: left;
    }
</style>
<div class="popup-box">
    <div class="popup popupimg" style=" position:relative;">
        <div class="close close-x"></div>
        <div class="tab-btn">
            <span id="StoreControl_tab_title01" class="tab-01 a-tab00" data-num="0" data-target="#StoreControl_tab_conter01"></span>
        </div>
        <form id="mcl">
            <div class="popup-con">
                <ul>
                    <li style="color:#fff;">售出</li>
                    <li class="ptsc_li">选择类型：
                        <select name="leixing" id="leixing" onChange="sl()" style="width:50%;height:26px;border-radius:5px;">
                            <option value="1">鸡</option>
                            <option value="2">蛋</option>
                            <option value="3">狗</option>
                        </select>
                    </li>
                    <li class="ptsc_li">鸡：<input type="text" name="cksy" id="cksy" value="0" style="border:none;background:none;font-size:18px;width:36%;"></li>
                    <li class="ptsc_li">蛋：<input type="text" name="" id="" value="0" style="border:none;background:none;font-size:18px;width:36%;"></li>
                    <li class="ptsc_li">数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;量：<input type="number" name="number" id="number" placeholder="售出数量(最高200)" maxlength="4" style="height:30px; width:50%; line-height:30px;border-radius:5px;text-indent:5px;"></li>
                    <li><input type="button" onClick="mc()" value="确定" style="width:50%;height:28px;line-height:22px;font-size:18px;margin-top:10px;border-radius:5px; background:#21EA15;color:#fff;"></li>
                </ul>
            </div>
        </form>
    </div>
</div>
<div class="popup-box1">
    <div class="popup popupimg" style=" position:relative;">
        <div class="close close-x"></div>
        <div class="tab-btn">
            <span id="StoreControl_tab_title01" class="tab-01 a-tab00" data-num="0" data-target="#StoreControl_tab_conter01"></span>
        </div>
        <form id="pt_sc">
            <div class="popup-con">
                <ul>
                    <li style="color:#fff;">平台限量售出</li>
                    <li class="ptsc_li">选择类型：
                        <select name="xiangliang" id="xiangliang" onChange="shuliang()" style="width:51%;height:26px;border-radius:5px;">
                            <option value="2">鸭</option>
                            <option value="1">蛋</option>
                        </select>
                    </li>
                    <li class="ptsc_li">仓库剩余：<input type="text" name="shengyu" id="shengyu" value="0" readonly style="border:none;background:none;font-size:18px;width:36%;"></li>
                    <li>购买数量：<input type="number" name="gm_number" id="gm_number" onKeyUp="jisuan()" placeholder="购买数量" maxlength="4" style="height:30px; width:50%; line-height:30px;border-radius:5px;text-indent:5px;font-size:18px;"></li>
                    <li class="ptsc_li">需&nbsp;&nbsp;支&nbsp;&nbsp;付：<input type="text" id="zf_caipiao" name="zf_caipiao" style="width:20%;background:none;border:none;text-align:center;font-size:18px;" readonly placeholder="0"> 菜票</li>
                    <li><input type="button" onClick="ptsc()" value="确定" style="width:50%;height:28px;line-height:22px;font-size:18px;margin-top:10px;border-radius:5px; background:#21EA15;color:#fff;"></li>
                </ul>
            </div>
        </form>
    </div>
</div>
<div class="popup-box2">
    <div class="popup popupimg" style=" position:relative;">
        <div class="close close-x"></div>
        <div class="tab-btn">
            <span id="StoreControl_tab_title01" class="tab-01 a-tab00" data-num="0" data-target="#StoreControl_tab_conter01"></span>
        </div>
        <form id="m_r">
            <div class="popup-con">
                <ul>
                    <li style="color:#fff;">买入</li>
                    <li>
                        售出数量：<input type="text" id="mcnumber" name="mcnumber" readonly class="mr_input" style="font-size:18px;background:none;border:none;">
                        <input type="hidden" name="farm_id" id="farm_id"><input type="hidden" name="mai_id" id="mai_id">
                    </li>
                    <li>
                        购买数量：<input type="number" name="mrnumber" id="mrnumber" maxlength="3" readonly placeholder="0" class="mr_input" style="font-size:18px;">
                    </li>
                    <li style="margin-left:9%;text-align:left;">需&nbsp;&nbsp;支&nbsp;&nbsp;付：<input type="text" id="caipiao" name="caipiao" style="width:20%;background:none;border:none;text-align:center;font-size:18px;" placeholder="0"> 菜票</li>
                    <li><input type="button" name="number" onClick="mairu()" value="立即支付"
                               style="width:50%;height:28px;line-height:22px;font-size:18px;margin-top:10px;border-radius:5px; background:#21EA15;color:#fff;">
                    </li>
                </ul>
            </div>
        </form>
    </div>
</div>
<div class="popup-box3">
    <div class="popup popupimg" style=" position:relative;">
        <div class="close close-x"></div>
        <div class="tab-btn">
            <span id="StoreControl_tab_title01" class="tab-01 a-tab00" data-num="0"
                  data-target="#StoreControl_tab_conter01"></span>
        </div>
        <form id="gm_sl">
            <div class="popup-con">
                <ul>
                    <li style="color:#fff;">平台限量售出</li>
                    <li class="ptsc_li">选择类型：<select name="gm_sllx" id="gm_sllx" style="width:51%;height:26px;border-radius:5px;">
                        <option value="4">鸡粮</option>
                        <!-- <option value="5" >狗粮</option> -->
                    </select>
                        <input type="hidden" id="timess" name="timess" value="">
                    </li>
                    <li style="margin-top:5px;">购买数量：<input type="number" name="sl_number" id="sl_number" value="100"
                                                            onKeyUp="sljisuan()" placeholder="购买数量" maxlength="4" style="height:30px; width:50%; line-height:30px;border-radius:5px;text-indent:5px;font-size:18px;">
                    </li>

                    <li class="ptsc_li">需&nbsp;&nbsp;支&nbsp;&nbsp;付：<input type="text" id="sl_caipiao" name="sl_caipiao"
                                                                           style="width:20%;background:none;border:none;text-align:center;font-size:18px;"
                                                                           value="10" readonly placeholder="0"> 菜票
                    </li>
                    <li><input type="button" onClick="gmsl()" value="确定" style="width:50%;height:28px;line-height:22px;font-size:18px;margin-top:10px;border-radius:5px; background:#21EA15;color:#fff;">
                    </li>
                </ul>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script src="../js/swiper.jquery.min.js"></script>
<script src="../js/index.js"></script>
<script src="../js/layer.js"></script>
<script type="text/javascript">
    var timess = Date.parse(new Date());
    document.getElementById("timess").value = timess;
    function jisuan() {
        //时时计算价格
        var number3 = document.getElementById("gm_number").value;	//购买数量
        var farm_id = document.getElementById("xiangliang").value;
        if (farm_id == 2) {
            if(number3>platDuckNum){
                number3 = platDuckNum;
                $("#gm_number").val(platDuckNum);
            }
            document.getElementById('zf_caipiao').value = accMul(number3, '2.40');//number3*'2.30'*100/100;
        }
        if (farm_id == 1) {
            if(number3>platEggNum){
                number3 = platEggNum;
                $("#gm_number").val(platEggNum);
            }
            document.getElementById('zf_caipiao').value = accMul(number3, '2.10');
        }
    }
    //乘法解决小数点问题
    function accMul(arg1, arg2) {
        var m = 0, s1 = arg1.toString(), s2 = arg2.toString();
        try {
            m += s1.split(".")[1].length
        } catch (e) {
        }
        try {
            m += s2.split(".")[1].length
        } catch (e) {
        }
        return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)
    }
    function buyOrder(orderId){
        alert(orderId);
    }
    // 行id 数量 用户 类型
    function mr(id, mcnumber, farm_id) {
        document.getElementById("farm_id").value = farm_id; //类型
        document.getElementById("mcnumber").value = mcnumber; //数量
        document.getElementById("mrnumber").value = mcnumber; //数量
        document.getElementById("mai_id").value = id;
        if (farm_id == 1) {
            document.getElementById('caipiao').value = accMul(mcnumber, '2.30');
        }
        if (farm_id == 2) {
            document.getElementById('caipiao').value = accMul(mcnumber, '2.00');
        }
        if (farm_id == 3) {
            document.getElementById('caipiao').value = accMul(mcnumber, '100.00');
        }
    }
    //数量
    function sl() {
        var a = document.getElementById("leixing").value;
        var timess = Date.parse(new Date());

    }
    //平台限量 数量
    function shuliang() {
        var xiangliang = document.getElementById("xiangliang").value; //类型
        jisuan(); //切换类型 更改价格
        if (xiangliang == 2) {
            document.getElementById('shengyu').value = platDuckNum * 100 / 100;
        }
        if (xiangliang == 1) {
            document.getElementById('shengyu').value = platEggNum * 100 / 100;
        }
    }
    //平台售出
    function ptsc() {
        var gm_number = document.getElementById("gm_number").value;
        var goodType = document.getElementById("xiangliang").value;
        if (gm_number < 10) {
            alert('购买不能小于10');
            return;
        }
        if (gm_number == '') {
            alert("请输入购买数量！");
            document.getElementById("gm_number").focus();
            return false;
        }
        jsonTokenAjax("/api/order/buyGoods", "POST", {"goodNumStr":gm_number,"goodTypeStr":goodType,"orderIdStr":"-1"}, buyGoodsCallBack, errorback);

        function buyGoodsCallBack(data){
            var result = data.result;
            if(result.code=='0000'){
                //提示
                layer.open({
                    content: "购买成功"
                    ,skin: 'msg'
                    ,time: 1 //2秒后自动关闭
                });
                window.setTimeout("window.location='farm_jyq.htm'",1200);
            } else{
                //提示
                layer.open({
                    content: result.message
                    ,skin: 'msg'
                    ,time: 1 //2秒后自动关闭
                });
            }
        }
    }
    //卖出
    function mc() {
        var a = document.getElementById("leixing").value;
        var b = document.getElementById("cksy").value;
        var c = document.getElementById("number").value;
        if (c < 10) {
            alert('售出不能小于10');
            return;
        }
        if (c == '') {
            alert("请输入售出数量！");
            document.getElementById("number").focus();
            return false;
        }
        //alert($("#mc").serialize());//console.log(data.farm_jis); 打印文本 submit 会跳转页面
    }
    //排队买入区买入弹窗
    function mairu() {
        if (document.getElementById("mrnumber").value < 1) {
            alert("请输入购买数量");
            document.getElementById("mrnumber").focus();
            return false;
        }
    }
    //饲料价格
    function sljisuan() {
        var number3 = document.getElementById("sl_number").value;	//购买数量
        var gm_sllx = document.getElementById("gm_sllx").value;
        var timess = Date.parse(new Date());
        document.getElementById("timess").value = timess;
        if (gm_sllx == 4) {
            document.getElementById('sl_caipiao').value = accMul(number3, '0.10'); //number3*('0.10'*100)/100;
        }
        if (gm_sllx == 5) {
            document.getElementById('sl_caipiao').value = accMul(number3, '0.10');
        }
    }
    //购买饲料
    function gmsl() {
        if (document.getElementById('sl_number').value == '') {
            alert("请正确输入购买数量！");
            document.getElementById('sl_number').focus();
            return false;
        }
    }
</script>
<script src="../js/main.js" tppabs="javascript:;"></script>
<script language="javascript">
    var allOrderPageSize = 4;
    var myOrderPageSize = 3;
    var allOrderOffSet = 0;
    var myOrderOffSet = 0;
    platEggNum = 0;
    platDuckNum = 0;
    function moreAllOrder(){
        jsonTokenAjax("/api/order/queryAllOrderList", "POST", {"offSet":allOrderOffSet,"pageSize":allOrderPageSize}, moreAllOrderCallBack, errorback);
    }
    function myOrderMore(){
        jsonTokenAjax("/api/order/queryMyOrderList", "POST", {"offSet":myOrderOffSet,"pageSize":myOrderPageSize}, moreMyOrderCallBack, errorback);
    }
    function moreAllOrderCallBack(data){
        if(data.status == "1"){
            var result = data.result;
            var allOrderList = result;
            createAllOrderHtml(allOrderList);
        }
    }
    function moreMyOrderCallBack (data){
        if(data.status == "1"){
            var result = data.result;
            var myOrderList = result;
            createMyOrderHtml(myOrderList);
        }
    }

    $(function () {
        jsonTokenAjax("/api/order/orderIndex", "POST", {}, callBack, errorback);
    });
    function callBack(data) {
        if(data.status == "1"){
            var result = data.result;
            var allOrderList = result.allOrderList;
            var myOrderList = result.myOrderList;
            var noticeList = result.noticeList;
            createAllOrderHtml(allOrderList);
            createMyOrderHtml(myOrderList);
            createNoticeHtml(noticeList);
            console.log(result);
            platEggNum = result.platformWarehouse.eggNum;
            platDuckNum = result.platformWarehouse.duckNum;
            shuliang();
        }
    }
    function createMyOrderHtml(myOrderList){
        var myOrderHtml = '';
        if(myOrderList !=null){
            myOrderOffSet = myOrderOffSet + myOrderList.length;
            $.each(myOrderList, function(index, value, array) {
                var typeStr = "";
                if(value.type == 1){
                    typeStr = "卖蛋";
                }else if(value.type == 2){
                    typeStr = "卖鸭";
                }
                var addTime = new Date(value.addTime);
                var addTimeStr = addTime.getHours()+":"+addTime.getMinutes();
                var statusStr = "";
                if(value.status == 1){
                    statusStr = "挂单中";
                }else{
                    statusStr = "已售出";
                }
                myOrderHtml = myOrderHtml + '<ul><li>'+addTimeStr+'</li><li>'+typeStr+'</li><li>'+value.num+'</li><li class="ddcj">'+statusStr+'</li></ul>';
            })
        }
        $("#myOrderList").html(myOrderHtml);
    }
    function createNoticeHtml(noticeList){
        var noticeHtml = '';
        if(noticeList !=null){
            $.each(noticeList, function(index, value, array){
                noticeHtml = noticeHtml + '系统提示：<samp>'+value.name+'</samp>&nbsp;&nbsp;'+value.remarks+'<br>';
            })
        }
        console.log(noticeList);
        $("#noticeList").html(noticeHtml);
    }
    function createAllOrderHtml(allOrderList){
        var allOrderHtml = '';
        if(allOrderList !=null){
            allOrderOffSet = allOrderOffSet + allOrderList.length;
            $.each(allOrderList, function(index, value, array) {
                allOrderHtml = allOrderHtml + '<ul><li style="width:25%"><img style="width:40px;border-radius:100%;" src="'+value.imgUrl+'" alt="头像"/></li>';
                allOrderHtml = allOrderHtml + '<li style="width:30%; overflow:hidden;text-overflow:ellipsis; white-space:nowrap;">'+value.name+'</li>';
                var typeStr = "";
                if(value.type == 1){
                    typeStr = "卖蛋";
                }else if(value.type == 2){
                    typeStr = "卖鸭";
                }
                var addTime = new Date(value.addTime);
                var addTimeStr = addTime.getHours()+":"+addTime.getMinutes();
                allOrderHtml = allOrderHtml + '<li style="width:15%;line-height:17px;">'+addTimeStr+'<br>'+ typeStr+'</li>';
                allOrderHtml = allOrderHtml + '<li style="width:15%">'+value.num+'</li>';
                if(value.status == 1){
                    allOrderHtml = allOrderHtml + '<li style="width:15%"><span class="jjsh up-box2" onClick="buyOrder('+value.orderId+')">买入</span></li></ul>';
                }else{
                    allOrderHtml = allOrderHtml + '<li style="width:15%"><span class="ddcj" >已售出</span></li></ul>';
                }
            });
        }
        $("#allOrderList").html(allOrderHtml);
    }
    function errorback(msg) {
        if(msg.status=="0"){
            window.location.href="user-1.htm?backurl=farm_jyq.htm";
        }
        alert('error:' + JSON.stringify(msg));
    }
</script>
<div style="position:absolute; bottom:28px; width:89%; border-radius:8px; margin-left:5%; text-align:center; background:RGBA(29,28,29,0.3);">
    <marquee direction="up" scrollamount="1" height="18" scrolldelay="1"
             style="font-size:16px; margin-left:8%; color:#FFF;">
        <div id="noticeList">
        </div>
    </marquee>
</div>
</body>
</html>